var SAPA_CONTACT=(()=>{var K=Object.defineProperty;var O=(e,t)=>()=>(e&&(t=e(e=0)),t);var q=(e,t)=>{for(var r in t)K(e,r,{get:t[r],enumerable:!0})};var R,A,h,u,w,Y,_,S=O(()=>{R={DEBOUNCE_DEFAULT:500,DEBOUNCE_SEARCH:300,THROTTLE_DEFAULT:1e3,ANIMATION_FRAME_FALLBACK:16,NOTIFICATION_AUTO_DISMISS:1e4,NOTIFICATION_SHORT:2e3,REMINDER_CHECK_INTERVAL:6e4,REMINDER_AUTO_DISMISS:15e3,COPY_FEEDBACK_DURATION:1500,FORM_MESSAGE_SUCCESS_DURATION:1e4,RSVP_CONFIRMATION_DURATION:3e3,RETRY_DELAY_BASE:1e3,SERVICE_WORKER_UPDATE_DISMISS:1e4},A={CONTACT_FORM:"/contact-handler.php",CSRF_TOKEN:"/csrf-token.php",NETLIFY_CONTACT:"/.netlify/functions/contact-form",NEWSLETTER_ARCHIVE:"/api/newsletters",MEETING_DATA:"/data/meetings/meetings.json"},h={ERROR:"error",SUCCESS:"success",WARNING:"warning",LOADING:"loading",DISABLED:"disabled",ACTIVE:"active",HIDDEN:"hidden",VISIBLE:"visible"},u={GENERIC:"An error occurred. Please try again.",NETWORK:"Network error. Please check your connection.",VALIDATION_FAILED:"Please correct the errors above before submitting.",LOAD_FAILED:"Failed to load content. Please try again.",SUBMISSION_FAILED:"Sorry, there was an error sending your message. Please try again.",CALENDAR_UNAVAILABLE:"Calendar temporarily unavailable. Please try refreshing the page.",MEETING_LOAD_FAILED:"Unable to load meetings. Please try again later.",REMINDER_PERMISSION_DENIED:"Notification permission was denied.",COPY_FAILED:"Failed to copy to clipboard."},w={FORM_SUBMITTED:"Thank you! Your message has been sent successfully.",SETTINGS_SAVED:"Settings have been saved successfully.",REMINDER_SET:"Reminder has been set.",COPIED_TO_CLIPBOARD:"Copied to clipboard!",RSVP_CONFIRMED:"Thanks for your RSVP!",RSVP_CANCELLED:"RSVP cancelled"},Y={GA_MEASUREMENT_ID:"G-XXXXXXXXXX",EVENTS:{PAGE_VIEW:"page_view",FORM_SUBMIT:"form_submit",FILE_DOWNLOAD:"file_download",NEWSLETTER_DOWNLOAD:"newsletter_download",MEETING_RSVP:"meeting_rsvp",SEARCH:"search",RESOURCE_VIEW:"resource_view"}},_={...Y.EVENTS,CONTACT_FORM_SUBMIT:"contact_form_submit",SEARCH_PERFORMED:"search_performed",REMINDER_SET:"reminder_set"}});function y(e,t={}){let{onError:r=null,fallbackValue:n=null,logError:o=!0,trackError:a=!0,errorMessage:s=u.GENERIC}=t;return async function(...c){try{return await e.apply(this,c)}catch(i){if(o&&console.error(`Error in ${e.name||"anonymous function"}:`,i),a&&typeof gtag=="function"&&gtag("event","exception",{description:i.message,fatal:!1,error_type:i.type||l.UNKNOWN}),r)return r(i);if(n!==null)return n;throw new E(s,i.type||l.UNKNOWN,{originalError:i})}}}async function v(e,t={}){let{maxRetries:r=3,initialDelay:n=1e3,maxDelay:o=1e4,backoffFactor:a=2,shouldRetry:s=i=>!0}=t,c;for(let i=0;i<r;i++)try{return await e()}catch(T){if(c=T,!s(T)||i===r-1)throw T;let m=Math.min(n*Math.pow(a,i),o);await new Promise(N=>setTimeout(N,m))}throw c}function b(e){return e.name==="NetworkError"||!navigator.onLine?new E(u.NETWORK,l.NETWORK,{offline:!navigator.onLine}):e.name==="TimeoutError"?new E("Request timed out. Please try again.",l.TIMEOUT):new E(e.message||u.NETWORK,l.NETWORK,{originalError:e})}function P(e){if(!e.ok)throw new E(`HTTP error! status: ${e.status}`,l.NETWORK,{status:e.status,statusText:e.statusText});return e}function z(e){return new Promise((t,r)=>{setTimeout(()=>{r(new E("Operation timed out",l.TIMEOUT))},e)})}async function U(e,t){return Promise.race([e,z(t)])}var l,E,G=O(()=>{S();l={NETWORK:"NETWORK_ERROR",VALIDATION:"VALIDATION_ERROR",PERMISSION:"PERMISSION_ERROR",TIMEOUT:"TIMEOUT_ERROR",PARSE:"PARSE_ERROR",UNKNOWN:"UNKNOWN_ERROR"},E=class extends Error{constructor(t,r=l.UNKNOWN,n={}){super(t),this.name="AppError",this.type=r,this.details=n,this.timestamp=new Date().toISOString()}}});var H={};q(H,{ApiClient:()=>I,apiClient:()=>C,clearExpiredCache:()=>k,loadJSON:()=>Q,submitForm:()=>j});function Z(e){let t=p.get(e);return t&&t.expires>Date.now()?t.data:(p.delete(e),null)}function ee(e,t,r){p.set(e,{data:t,expires:Date.now()+r})}function k(){let e=Date.now();for(let[t,r]of p.entries())r.expires<=e&&p.delete(t)}var J,I,C,j,Q,p,W=O(()=>{G();S();J={timeout:3e4,retries:3,headers:{"Content-Type":"application/json",Accept:"application/json"}},I=class{constructor(t={}){this.config={...J,...t},this.baseURL=t.baseURL||""}async request(t,r={}){let n=this.baseURL+t,o={...r,headers:{...this.config.headers,...r.headers}};if(o.method!=="GET"){let a=await this.getCSRFToken();a&&(o.headers["X-CSRF-Token"]=a)}try{let a=await v(async()=>{let c=fetch(n,o),i=await U(c,r.timeout||this.config.timeout);return P(i)},{maxRetries:r.retries||this.config.retries,shouldRetry:c=>c.type===l.NETWORK||c.details?.status>=500}),s=a.headers.get("content-type");return s&&s.includes("application/json")?await a.json():await a.text()}catch(a){throw b(a)}}async get(t,r={}){return this.request(t,{...r,method:"GET"})}async post(t,r,n={}){return this.request(t,{...n,method:"POST",body:JSON.stringify(r)})}async put(t,r,n={}){return this.request(t,{...n,method:"PUT",body:JSON.stringify(r)})}async delete(t,r={}){return this.request(t,{...r,method:"DELETE"})}async getCSRFToken(){try{let t=await fetch(A.CSRF_TOKEN);if(t.ok)return(await t.json()).token}catch(t){console.warn("Failed to get CSRF token:",t)}return null}},C=new I,j=y(async(e,t,r={})=>{let n=t instanceof FormData?t:new FormData;return t instanceof FormData||Object.entries(t).forEach(([a,s])=>{n.append(a,s)}),await C.request(e,{...r,method:"POST",body:n,headers:{Accept:"application/json"}})},{errorMessage:"Form submission failed. Please try again.",trackError:!0}),Q=y(async(e,t={})=>{let r=`json_cache_${e}`,n=t.cacheDuration||36e5;if(t.useCache){let a=Z(r);if(a)return a}let o=await C.get(e,t);return t.useCache&&ee(r,o,n),o},{errorMessage:"Failed to load data. Please try again.",fallbackValue:null}),p=new Map;setInterval(k,R.REMINDER_CHECK_INTERVAL)});S();function M(e,t=R.DEBOUNCE_DEFAULT){if(typeof e!="function")throw new TypeError("First argument must be a function");let r;return function(...o){let a=()=>{clearTimeout(r),e(...o)};clearTimeout(r),r=setTimeout(a,t)}}function g(e,t=document){try{return t.querySelector(e)}catch(r){return console.warn(`Failed to query selector "${e}":`,r),null}}var d=new Map;function f(e,t,r,n){if(!e||typeof e.addEventListener!="function"){console.warn("Invalid element provided to addEventListenerWithCleanup");return}e.addEventListener(t,r,n),d.has(e)||d.set(e,[]),d.get(e).push({event:t,handler:r,options:n})}function $(e=null){if(e){let t=d.get(e);t&&(t.forEach(({event:r,handler:n,options:o})=>{e.removeEventListener(r,n,o)}),d.delete(e))}else d.forEach((t,r)=>{t.forEach(({event:n,handler:o,options:a})=>{try{r.removeEventListener(n,o,a)}catch(s){console.warn("Failed to remove event listener:",s)}})}),d.clear()}typeof window<"u"&&window.addEventListener("beforeunload",()=>{$()});function x(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function F(e){return/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(e)}S();function B(){let e=g("#contact-form");e&&te(e);let t=g("#meeting-location-map");t&&ie(t),ce()}function te(e){e.querySelectorAll("input, textarea").forEach(n=>{f(n,"blur",L),f(n,"input",M(L,500))}),f(e,"submit",ae);let r=e.querySelector("#message");r&&oe(r)}function L(e){let t=e.target,r=t.value.trim(),n=t.name||t.id;if(V(t),!r&&!t.required)return!0;let o=!0,a="";switch(n){case"name":case"firstName":case"lastName":r.length<2&&(o=!1,a="Name must be at least 2 characters long");break;case"email":x(r)||(o=!1,a="Please enter a valid email address");break;case"phone":r&&!F(r)&&(o=!1,a="Please enter a valid phone number (XXX) XXX-XXXX");break;case"message":r.length<10?(o=!1,a="Message must be at least 10 characters long"):r.length>1e3&&(o=!1,a="Message must be less than 1000 characters");break;case"subject":r.length<5&&(o=!1,a="Subject must be at least 5 characters long");break}return t.required&&!r&&(o=!1,a="This field is required"),o?ne(t):re(t,a),o}function V(e){e.classList.remove("error","success");let t=e.parentNode.querySelector(".field-error");t&&t.remove()}function re(e,t){e.classList.add("error"),e.classList.remove("success");let r=document.createElement("div");r.className="field-error",r.textContent=t,r.setAttribute("role","alert"),e.parentNode.appendChild(r)}function ne(e){e.classList.add("success"),e.classList.remove("error")}function oe(e){let r=document.createElement("div");r.className="character-counter";let n=()=>{let o=1e3-e.value.length;r.textContent=`${o} characters remaining`,r.className=`character-counter ${o<50?"warning":""}`};e.parentNode.appendChild(r),f(e,"input",n),n()}async function ae(e){e.preventDefault();let t=e.target,r=t.querySelector('button[type="submit"]'),n=r.textContent,o=t.querySelectorAll("input[required], textarea[required]"),a=!0;if(o.forEach(s=>{L({target:s})||(a=!1)}),!a){D(u.VALIDATION_FAILED,h.ERROR);return}r.disabled=!0,r.textContent="Sending...";try{let s=new FormData(t),c=Object.fromEntries(s.entries()),i=await se();i&&(c.csrf_token=i);let{apiClient:T}=await Promise.resolve().then(()=>(W(),H)),m=await fetch(A.CONTACT_FORM,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),N=await m.json();if(m.ok&&N.success)D(w.FORM_SUBMITTED,h.SUCCESS),t.reset(),o.forEach(X=>V(X)),typeof gtag=="function"&&gtag("event",_.CONTACT_FORM_SUBMIT,{success:!0});else throw new Error(N.message||u.SUBMISSION_FAILED)}catch(s){console.error("Form submission failed:",s),D(u.SUBMISSION_FAILED,h.ERROR),typeof gtag=="function"&&gtag("event",_.CONTACT_FORM_SUBMIT,{success:!1,error:s.message})}finally{r.disabled=!1,r.textContent=n}}function D(e,t){let r=document.querySelector(".form-message");r&&r.remove();let n=document.createElement("div");n.className=`form-message ${t}`,n.textContent=e,n.setAttribute("role","alert");let o=document.querySelector("#contact-form");o.insertBefore(n,o.firstChild),t==="success"&&setTimeout(()=>{n.remove()},1e4)}async function se(){try{return(await(await fetch("csrf-token.php")).json()).token}catch(e){return console.warn("Failed to get CSRF token:",e),null}}function ie(e){e.innerHTML=`
        <div class="map-container">
            <div class="map-placeholder">
                <h4>Meeting Location</h4>
                <address>
                    <strong>San Antonio Public Library</strong><br>
                    Central Branch - Conference Room B<br>
                    600 Soledad Street<br>
                    San Antonio, TX 78205
                </address>
                <div class="map-actions">
                    <a href="https://www.google.com/maps/search/?api=1&query=San+Antonio+Public+Library+Central+Branch" 
                       target="_blank" class="btn-secondary">
                        \u{1F4CD} Open in Google Maps
                    </a>
                    <button class="btn-secondary" onclick="copyAddress()">
                        \u{1F4CB} Copy Address
                    </button>
                </div>
            </div>
        </div>
    `,window.copyAddress=function(){let n="San Antonio Public Library, Central Branch - Conference Room B, 600 Soledad Street, San Antonio, TX 78205";navigator.clipboard?navigator.clipboard.writeText(n).then(()=>{t()}).catch(o=>{console.error("Failed to copy address:",o),r(n)}):r(n)};function t(){let n=e.querySelector('button[onclick="copyAddress()"]'),o=n.textContent;n.textContent="\u2705 Copied!",setTimeout(()=>{n.textContent=o},2e3)}function r(n){let o=document.createElement("textarea");o.value=n,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select();try{document.execCommand("copy"),t()}catch(a){console.error("Fallback copy failed:",a),alert("Please manually copy the address from above.")}document.body.removeChild(o)}}function ce(){document.querySelectorAll("[data-copy]").forEach(t=>{f(t,"click",r=>{let n=r.target.dataset.copy||r.target.textContent;navigator.clipboard&&navigator.clipboard.writeText(n).then(()=>{le(r.target)}).catch(o=>{console.error("Failed to copy:",o)})})})}function le(e){let t=e.textContent;e.textContent="Copied!",e.style.backgroundColor="#e8f5e8",setTimeout(()=>{e.textContent=t,e.style.backgroundColor=""},1500)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B();})();
