var SAPA_CONTACT=(()=>{var v=Object.defineProperty,J=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var F=(e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c=(e,t)=>{for(var r in t||(t={}))Q.call(t,r)&&F(e,r,t[r]);if(x)for(var r of x(t))Z.call(t,r)&&F(e,r,t[r]);return e},E=(e,t)=>J(e,j(t));var g=(e,t)=>()=>(e&&(t=e(e=0)),t);var ee=(e,t)=>{for(var r in t)v(e,r,{get:t[r],enumerable:!0})};var h,I,O,d,b,te,y,T=g(()=>{h={DEBOUNCE_DEFAULT:500,DEBOUNCE_SEARCH:300,THROTTLE_DEFAULT:1e3,ANIMATION_FRAME_FALLBACK:16,NOTIFICATION_AUTO_DISMISS:1e4,NOTIFICATION_SHORT:2e3,REMINDER_CHECK_INTERVAL:6e4,REMINDER_AUTO_DISMISS:15e3,COPY_FEEDBACK_DURATION:1500,FORM_MESSAGE_SUCCESS_DURATION:1e4,RSVP_CONFIRMATION_DURATION:3e3,RETRY_DELAY_BASE:1e3,SERVICE_WORKER_UPDATE_DISMISS:1e4},I={CONTACT_FORM:"/contact-handler.php",CSRF_TOKEN:"/csrf-token.php",NETLIFY_CONTACT:"/.netlify/functions/contact-form",NEWSLETTER_ARCHIVE:"/api/newsletters",MEETING_DATA:"/data/meetings/meetings.json"},O={ERROR:"error",SUCCESS:"success",WARNING:"warning",LOADING:"loading",DISABLED:"disabled",ACTIVE:"active",HIDDEN:"hidden",VISIBLE:"visible"},d={GENERIC:"An error occurred. Please try again.",NETWORK:"Network error. Please check your connection.",VALIDATION_FAILED:"Please correct the errors above before submitting.",LOAD_FAILED:"Failed to load content. Please try again.",SUBMISSION_FAILED:"Sorry, there was an error sending your message. Please try again.",CALENDAR_UNAVAILABLE:"Calendar temporarily unavailable. Please try refreshing the page.",MEETING_LOAD_FAILED:"Unable to load meetings. Please try again later.",REMINDER_PERMISSION_DENIED:"Notification permission was denied.",COPY_FAILED:"Failed to copy to clipboard."},b={FORM_SUBMITTED:"Thank you! Your message has been sent successfully.",SETTINGS_SAVED:"Settings have been saved successfully.",REMINDER_SET:"Reminder has been set.",COPIED_TO_CLIPBOARD:"Copied to clipboard!",RSVP_CONFIRMED:"Thanks for your RSVP!",RSVP_CANCELLED:"RSVP cancelled"},te={GA_MEASUREMENT_ID:"G-XXXXXXXXXX",EVENTS:{PAGE_VIEW:"page_view",FORM_SUBMIT:"form_submit",FILE_DOWNLOAD:"file_download",NEWSLETTER_DOWNLOAD:"newsletter_download",MEETING_RSVP:"meeting_rsvp",SEARCH:"search",RESOURCE_VIEW:"resource_view"}},y=E(c({},te.EVENTS),{CONTACT_FORM_SUBMIT:"contact_form_submit",SEARCH_PERFORMED:"search_performed",REMINDER_SET:"reminder_set"})});function L(e,t={}){let{onError:r=null,fallbackValue:n=null,logError:o=!0,trackError:a=!0,errorMessage:i=d.GENERIC}=t;return async function(...l){try{return await e.apply(this,l)}catch(s){if(o&&console.error(`Error in ${e.name||"anonymous function"}:`,s),a&&typeof gtag=="function"&&gtag("event","exception",{description:s.message,fatal:!1,error_type:s.type||u.UNKNOWN}),r)return r(s);if(n!==null)return n;throw new f(i,s.type||u.UNKNOWN,{originalError:s})}}}async function H(e,t={}){let{maxRetries:r=3,initialDelay:n=1e3,maxDelay:o=1e4,backoffFactor:a=2,shouldRetry:i=s=>!0}=t,l;for(let s=0;s<r;s++)try{return await e()}catch(N){if(l=N,!i(N)||s===r-1)throw N;let R=Math.min(n*Math.pow(a,s),o);await new Promise(A=>setTimeout(A,R))}throw l}function k(e){return e.name==="NetworkError"||!navigator.onLine?new f(d.NETWORK,u.NETWORK,{offline:!navigator.onLine}):e.name==="TimeoutError"?new f("Request timed out. Please try again.",u.TIMEOUT):new f(e.message||d.NETWORK,u.NETWORK,{originalError:e})}function W(e){if(!e.ok)throw new f(`HTTP error! status: ${e.status}`,u.NETWORK,{status:e.status,statusText:e.statusText});return e}function ne(e){return new Promise((t,r)=>{setTimeout(()=>{r(new f("Operation timed out",u.TIMEOUT))},e)})}async function B(e,t){return Promise.race([e,ne(t)])}var u,f,V=g(()=>{T();u={NETWORK:"NETWORK_ERROR",VALIDATION:"VALIDATION_ERROR",PERMISSION:"PERMISSION_ERROR",TIMEOUT:"TIMEOUT_ERROR",PARSE:"PARSE_ERROR",UNKNOWN:"UNKNOWN_ERROR"},f=class extends Error{constructor(t,r=u.UNKNOWN,n={}){super(t),this.name="AppError",this.type=r,this.details=n,this.timestamp=new Date().toISOString()}}});var K={};ee(K,{ApiClient:()=>_,apiClient:()=>D,clearExpiredCache:()=>X,loadJSON:()=>se,submitForm:()=>ae});function ie(e){let t=m.get(e);return t&&t.expires>Date.now()?t.data:(m.delete(e),null)}function ce(e,t,r){m.set(e,{data:t,expires:Date.now()+r})}function X(){let e=Date.now();for(let[t,r]of m.entries())r.expires<=e&&m.delete(t)}var oe,_,D,ae,se,m,q=g(()=>{V();T();oe={timeout:3e4,retries:3,headers:{"Content-Type":"application/json",Accept:"application/json"}},_=class{constructor(t={}){this.config=c(c({},oe),t),this.baseURL=t.baseURL||""}async request(t,r={}){let n=this.baseURL+t,o=E(c({},r),{headers:c(c({},this.config.headers),r.headers)});if(o.method!=="GET"){let a=await this.getCSRFToken();a&&(o.headers["X-CSRF-Token"]=a)}try{let a=await H(async()=>{let l=fetch(n,o),s=await B(l,r.timeout||this.config.timeout);return W(s)},{maxRetries:r.retries||this.config.retries,shouldRetry:l=>{var s;return l.type===u.NETWORK||((s=l.details)==null?void 0:s.status)>=500}}),i=a.headers.get("content-type");return i&&i.includes("application/json")?await a.json():await a.text()}catch(a){throw k(a)}}async get(t,r={}){return this.request(t,E(c({},r),{method:"GET"}))}async post(t,r,n={}){return this.request(t,E(c({},n),{method:"POST",body:JSON.stringify(r)}))}async put(t,r,n={}){return this.request(t,E(c({},n),{method:"PUT",body:JSON.stringify(r)}))}async delete(t,r={}){return this.request(t,E(c({},r),{method:"DELETE"}))}async getCSRFToken(){try{let t=await fetch(I.CSRF_TOKEN);if(t.ok)return(await t.json()).token}catch(t){console.warn("Failed to get CSRF token:",t)}return null}},D=new _,ae=L(async(e,t,r={})=>{let n=t instanceof FormData?t:new FormData;return t instanceof FormData||Object.entries(t).forEach(([a,i])=>{n.append(a,i)}),await D.request(e,E(c({},r),{method:"POST",body:n,headers:{Accept:"application/json"}}))},{errorMessage:"Form submission failed. Please try again.",trackError:!0}),se=L(async(e,t={})=>{let r=`json_cache_${e}`,n=t.cacheDuration||36e5;if(t.useCache){let a=ie(r);if(a)return a}let o=await D.get(e,t);return t.useCache&&ce(r,o,n),o},{errorMessage:"Failed to load data. Please try again.",fallbackValue:null}),m=new Map;setInterval(X,h.REMINDER_CHECK_INTERVAL)});T();function P(e,t=h.DEBOUNCE_DEFAULT){if(typeof e!="function")throw new TypeError("First argument must be a function");let r;return function(...o){let a=()=>{clearTimeout(r),e(...o)};clearTimeout(r),r=setTimeout(a,t)}}function C(e,t=document){try{return t.querySelector(e)}catch(r){return console.warn(`Failed to query selector "${e}":`,r),null}}var S=new Map;function p(e,t,r,n){if(!e||typeof e.addEventListener!="function"){console.warn("Invalid element provided to addEventListenerWithCleanup");return}e.addEventListener(t,r,n),S.has(e)||S.set(e,[]),S.get(e).push({event:t,handler:r,options:n})}function re(e=null){if(e){let t=S.get(e);t&&(t.forEach(({event:r,handler:n,options:o})=>{e.removeEventListener(r,n,o)}),S.delete(e))}else S.forEach((t,r)=>{t.forEach(({event:n,handler:o,options:a})=>{try{r.removeEventListener(n,o,a)}catch(i){console.warn("Failed to remove event listener:",i)}})}),S.clear()}typeof window!="undefined"&&window.addEventListener("beforeunload",()=>{re()});function U(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function G(e){return/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(e)}T();function Y(){let e=C("#contact-form");e&&le(e);let t=C("#meeting-location-map");t&&pe(t),Te()}function le(e){e.querySelectorAll("input, textarea").forEach(n=>{p(n,"blur",w),p(n,"input",P(w,500))}),p(e,"submit",fe);let r=e.querySelector("#message");r&&de(r)}function w(e){let t=e.target,r=t.value.trim(),n=t.name||t.id;if($(t),!r&&!t.required)return!0;let o=!0,a="";switch(n){case"name":case"firstName":case"lastName":r.length<2&&(o=!1,a="Name must be at least 2 characters long");break;case"email":U(r)||(o=!1,a="Please enter a valid email address");break;case"phone":r&&!G(r)&&(o=!1,a="Please enter a valid phone number (XXX) XXX-XXXX");break;case"message":r.length<10?(o=!1,a="Message must be at least 10 characters long"):r.length>1e3&&(o=!1,a="Message must be less than 1000 characters");break;case"subject":r.length<5&&(o=!1,a="Subject must be at least 5 characters long");break}return t.required&&!r&&(o=!1,a="This field is required"),o?Ee(t):ue(t,a),o}function $(e){e.classList.remove("error","success");let t=e.parentNode.querySelector(".field-error");t&&t.remove()}function ue(e,t){e.classList.add("error"),e.classList.remove("success");let r=document.createElement("div");r.className="field-error",r.textContent=t,r.setAttribute("role","alert"),e.parentNode.appendChild(r)}function Ee(e){e.classList.add("success"),e.classList.remove("error")}function de(e){let r=document.createElement("div");r.className="character-counter";let n=()=>{let o=1e3-e.value.length;r.textContent=`${o} characters remaining`,r.className=`character-counter ${o<50?"warning":""}`};e.parentNode.appendChild(r),p(e,"input",n),n()}async function fe(e){e.preventDefault();let t=e.target,r=t.querySelector('button[type="submit"]'),n=r.textContent,o=t.querySelectorAll("input[required], textarea[required]"),a=!0;if(o.forEach(i=>{w({target:i})||(a=!1)}),!a){M(d.VALIDATION_FAILED,O.ERROR);return}r.disabled=!0,r.textContent="Sending...";try{let i=new FormData(t),l=Object.fromEntries(i.entries()),s=await Se();s&&(l.csrf_token=s);let{apiClient:N}=await Promise.resolve().then(()=>(q(),K)),R=await fetch(I.CONTACT_FORM,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),A=await R.json();if(R.ok&&A.success)M(b.FORM_SUBMITTED,O.SUCCESS),t.reset(),o.forEach(z=>$(z)),typeof gtag=="function"&&gtag("event",y.CONTACT_FORM_SUBMIT,{success:!0});else throw new Error(A.message||d.SUBMISSION_FAILED)}catch(i){console.error("Form submission failed:",i),M(d.SUBMISSION_FAILED,O.ERROR),typeof gtag=="function"&&gtag("event",y.CONTACT_FORM_SUBMIT,{success:!1,error:i.message})}finally{r.disabled=!1,r.textContent=n}}function M(e,t){let r=document.querySelector(".form-message");r&&r.remove();let n=document.createElement("div");n.className=`form-message ${t}`,n.textContent=e,n.setAttribute("role","alert");let o=document.querySelector("#contact-form");o.insertBefore(n,o.firstChild),t==="success"&&setTimeout(()=>{n.remove()},1e4)}async function Se(){try{return(await(await fetch("csrf-token.php")).json()).token}catch(e){return console.warn("Failed to get CSRF token:",e),null}}function pe(e){e.innerHTML=`
        <div class="map-container">
            <div class="map-placeholder">
                <h4>Meeting Location</h4>
                <address>
                    <strong>San Antonio Public Library</strong><br>
                    Central Branch - Conference Room B<br>
                    600 Soledad Street<br>
                    San Antonio, TX 78205
                </address>
                <div class="map-actions">
                    <a href="https://www.google.com/maps/search/?api=1&query=San+Antonio+Public+Library+Central+Branch" 
                       target="_blank" class="btn-secondary">
                        \u{1F4CD} Open in Google Maps
                    </a>
                    <button class="btn-secondary" onclick="copyAddress()">
                        \u{1F4CB} Copy Address
                    </button>
                </div>
            </div>
        </div>
    `,window.copyAddress=function(){let n="San Antonio Public Library, Central Branch - Conference Room B, 600 Soledad Street, San Antonio, TX 78205";navigator.clipboard?navigator.clipboard.writeText(n).then(()=>{t()}).catch(o=>{console.error("Failed to copy address:",o),r(n)}):r(n)};function t(){let n=e.querySelector('button[onclick="copyAddress()"]'),o=n.textContent;n.textContent="\u2705 Copied!",setTimeout(()=>{n.textContent=o},2e3)}function r(n){let o=document.createElement("textarea");o.value=n,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select();try{document.execCommand("copy"),t()}catch(a){console.error("Fallback copy failed:",a),alert("Please manually copy the address from above.")}document.body.removeChild(o)}}function Te(){document.querySelectorAll("[data-copy]").forEach(t=>{p(t,"click",r=>{let n=r.target.dataset.copy||r.target.textContent;navigator.clipboard&&navigator.clipboard.writeText(n).then(()=>{me(r.target)}).catch(o=>{console.error("Failed to copy:",o)})})})}function me(e){let t=e.textContent;e.textContent="Copied!",e.style.backgroundColor="#e8f5e8",setTimeout(()=>{e.textContent=t,e.style.backgroundColor=""},1500)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Y):Y();})();
