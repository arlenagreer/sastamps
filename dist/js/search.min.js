var SAPA_SEARCH=(()=>{var A=Object.defineProperty;var D=(r,e)=>()=>(r&&(e=r(r=0)),e);var H=(r,e)=>{for(var t in e)A(r,t,{get:e[t],enumerable:!0})};var F={};H(F,{default:()=>R});var w,R,q=D(()=>{w=class{constructor(e={}){this.index=null,this.documents=new Map,this.isLoaded=!1,this.isLoading=!1,this.baseUrl=e.baseUrl||"./dist/data",this.lunrUrl=e.lunrUrl||"https://unpkg.com/lunr@2.3.9/lunr.min.js",this.callbacks={onLoad:e.onLoad||(()=>{}),onSearch:e.onSearch||(()=>{}),onError:e.onError||(t=>console.error("Search error:",t))},this.ensureLunrLoaded()}async ensureLunrLoaded(){return typeof lunr<"u"?Promise.resolve():new Promise((e,t)=>{let a=document.createElement("script");a.src=this.lunrUrl,a.onload=()=>e(),a.onerror=()=>t(new Error("Failed to load Lunr.js")),document.head.appendChild(a)})}async initialize(){if(!(this.isLoaded||this.isLoading)){this.isLoading=!0;try{console.log("\u{1F50D} Initializing search engine..."),await this.ensureLunrLoaded();let[e,t]=await Promise.all([this.loadSearchIndex(),this.loadSearchDocuments()]);this.index=lunr.Index.load(e),this.buildDocumentsMap(t.documents),this.isLoaded=!0,this.isLoading=!1,console.log(`\u2705 Search engine initialized with ${t.documents.length} documents`),this.callbacks.onLoad(t.metadata)}catch(e){throw this.isLoading=!1,console.error("\u274C Failed to initialize search engine:",e),this.callbacks.onError(e),e}}}async loadSearchIndex(){let e=await fetch(`${this.baseUrl}/search-index.json`);if(!e.ok)throw new Error(`Failed to load search index: ${e.statusText}`);return e.json()}async loadSearchDocuments(){let e=await fetch(`${this.baseUrl}/search-documents.json`);if(!e.ok)throw new Error(`Failed to load search documents: ${e.statusText}`);return e.json()}buildDocumentsMap(e){this.documents.clear(),e.forEach(t=>{this.documents.set(t.id,t)})}async search(e,t={}){this.isLoaded||await this.initialize();let{limit:a=50,types:s=[],categories:i=[],difficulty:o=[],boost:d=!0}=t;try{console.log(`\u{1F50E} Searching for: "${e}"`);let c=this.index.search(e).map(l=>{let f=this.documents.get(l.ref);return{id:l.ref,score:l.score,document:f,matches:l.matchData||{}}});c=this.applyFilters(c,{types:s,categories:i,difficulty:o}),a>0&&(c=c.slice(0,a));let p={query:e,results:c,total:c.length,hasResults:c.length>0,metadata:{searchTime:Date.now(),totalDocuments:this.documents.size,appliedFilters:{types:s,categories:i,difficulty:o}}};return console.log(`\u{1F4CA} Found ${c.length} results for "${e}"`),this.callbacks.onSearch(p),p}catch(n){return console.error("Search error:",n),this.callbacks.onError(n),{query:e,results:[],total:0,hasResults:!1,error:n.message}}}applyFilters(e,t){let{types:a,categories:s,difficulty:i,dateRange:o,tags:d,years:n,quarters:c}=t;return e.filter(p=>{let l=p.document;if(!l||a&&a.length>0&&!a.includes(l.type)||s&&s.length>0&&!s.includes(l.category)||i&&i.length>0&&l.difficulty&&!i.includes(l.difficulty))return!1;if(o&&o.from&&o.to&&l.date){let f=new Date(l.date),g=new Date(o.from),S=new Date(o.to);if(f<g||f>S)return!1}if(d&&d.length>0&&l.tags&&!d.some(g=>l.tags.includes(g)))return!1;if(n&&n.length>0&&l.date){let f=new Date(l.date).getFullYear();if(!n.includes(f.toString()))return!1}return!(c&&c.length>0&&l.quarter&&!c.includes(l.quarter))})}async getSuggestions(e,t=5){if(!this.isLoaded||!e||e.length<2)return[];try{let a=`${e}*`;return(await this.search(a,{limit:t})).results.map(i=>({text:i.document.title,type:i.document.type,url:i.document.url}))}catch(a){return console.error("Suggestions error:",a),[]}}getFilterOptions(){if(!this.isLoaded)return{types:[],categories:[],difficulty:[],years:[],quarters:[],tags:[]};let e={types:new Set,categories:new Set,difficulty:new Set,years:new Set,quarters:new Set,tags:new Set};return this.documents.forEach(t=>{if(t.type&&e.types.add(t.type),t.category&&e.categories.add(t.category),t.difficulty&&e.difficulty.add(t.difficulty),t.quarter&&e.quarters.add(t.quarter),t.date){let a=new Date(t.date).getFullYear();e.years.add(a.toString())}t.tags&&Array.isArray(t.tags)&&t.tags.forEach(a=>e.tags.add(a))}),{types:Array.from(e.types).sort(),categories:Array.from(e.categories).sort(),difficulty:Array.from(e.difficulty).sort(),years:Array.from(e.years).sort().reverse(),quarters:["First","Second","Third","Fourth"],tags:Array.from(e.tags).sort()}}createSearchUI(e,t={}){let{placeholder:a="Search newsletters, meetings, resources...",showFilters:s=!0,showSuggestions:i=!0,autoSearch:o=!0,searchDelay:d=300}=t;if(typeof e=="string"&&(e=document.querySelector(e)),!e)throw new Error("Search container not found");return e.innerHTML=this.generateSearchHTML(a,s),this.initializeSearchUI(e,{showSuggestions:i,autoSearch:o,searchDelay:d}),e}generateSearchHTML(e,t){return`
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input type="search" 
                           class="search-input" 
                           placeholder="${e}"
                           autocomplete="off"
                           spellcheck="false">
                    <button class="search-button" type="button">
                        <i class="fas fa-search"></i>
                    </button>
                    <div class="search-suggestions" style="display: none;"></div>
                </div>
                
                ${t?`
                    <div class="search-filters">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>Type:</label>
                                <select class="filter-select" data-filter="type">
                                    <option value="">All Types</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Year:</label>
                                <select class="filter-select" data-filter="year">
                                    <option value="">All Years</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Quarter:</label>
                                <select class="filter-select" data-filter="quarter">
                                    <option value="">All Quarters</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>Date From:</label>
                                <input type="date" class="filter-input" data-filter="date-from">
                            </div>
                            <div class="filter-group">
                                <label>Date To:</label>
                                <input type="date" class="filter-input" data-filter="date-to">
                            </div>
                            <div class="filter-group">
                                <label>Tags:</label>
                                <select class="filter-select" data-filter="tags" multiple>
                                </select>
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button class="clear-filters-button" type="button">
                                <i class="fas fa-times"></i> Clear Filters
                            </button>
                            <button class="toggle-filters-button" type="button">
                                <i class="fas fa-chevron-up"></i> Hide Filters
                            </button>
                        </div>
                    </div>
                `:""}
                
                <div class="search-results">
                    <div class="search-status"></div>
                    <div class="search-results-list"></div>
                </div>
            </div>
        `}async initializeSearchUI(e,t){let{showSuggestions:a,autoSearch:s,searchDelay:i}=t,o=e.querySelector(".search-input"),d=e.querySelector(".search-button"),n=e.querySelector(".search-suggestions"),c=e.querySelector(".search-results-list"),p=e.querySelector(".search-status"),l=e.querySelectorAll(".filter-select"),f=e.querySelectorAll(".filter-input"),g=e.querySelector(".clear-filters-button"),S=e.querySelector(".toggle-filters-button"),k,v="";await this.initialize(),this.populateFilterOptions(l),o.addEventListener("input",u=>{let m=u.target.value.trim();v=m,s&&(clearTimeout(k),k=setTimeout(()=>{m?this.performUISearch(m,e):this.clearResults(e)},i)),a&&m.length>=2?this.showSuggestions(m,n,o):n.style.display="none"}),d.addEventListener("click",()=>{let u=o.value.trim();u&&this.performUISearch(u,e)}),o.addEventListener("keydown",u=>{if(u.key==="Enter"){u.preventDefault();let m=o.value.trim();m&&this.performUISearch(m,e)}}),l.forEach(u=>{u.addEventListener("change",()=>{v&&this.performUISearch(v,e)})}),f.forEach(u=>{u.addEventListener("change",()=>{v&&this.performUISearch(v,e)})}),g&&g.addEventListener("click",()=>{l.forEach(u=>{u.hasAttribute("multiple")?Array.from(u.options).forEach(m=>m.selected=!1):u.value=""}),f.forEach(u=>u.value=""),v&&this.performUISearch(v,e)}),S&&S.addEventListener("click",()=>{let u=e.querySelector(".search-filters");u.classList.contains("collapsed")?(u.classList.remove("collapsed"),S.innerHTML='<i class="fas fa-chevron-up"></i> Hide Filters'):(u.classList.add("collapsed"),S.innerHTML='<i class="fas fa-chevron-down"></i> Show Filters')}),document.addEventListener("click",u=>{e.contains(u.target)||(n.style.display="none")})}populateFilterOptions(e){let t=this.getFilterOptions();e.forEach(a=>{let s=a.dataset.filter,i=[];switch(s){case"type":i=t.types.map(o=>({value:o,label:this.formatLabel(o)}));break;case"category":i=t.categories.map(o=>({value:o,label:this.formatLabel(o)}));break;case"difficulty":i=t.difficulty.map(o=>({value:o,label:this.formatLabel(o)}));break;case"year":i=t.years.map(o=>({value:o,label:o}));break;case"quarter":i=t.quarters.map(o=>({value:o,label:o}));break;case"tags":i=t.tags.map(o=>({value:o,label:this.formatLabel(o)}));break}i.forEach(o=>{let d=document.createElement("option");d.value=o.value,d.textContent=o.label,a.appendChild(d)})})}formatLabel(e){return e.replace(/-/g," ").replace(/\b\w/g,t=>t.toUpperCase())}async performUISearch(e,t){let a=t.querySelector(".search-results-list"),s=t.querySelector(".search-status"),i=t.querySelectorAll(".filter-select"),o=t.querySelectorAll(".filter-input");s.innerHTML='<div class="search-loading">Searching...</div>',a.innerHTML="";let d={};i.forEach(p=>{let l=p.dataset.filter;if(p.hasAttribute("multiple")){let f=Array.from(p.selectedOptions).map(g=>g.value);f.length>0&&(d[l]=f)}else{let f=p.value;f&&(l==="type"?d.types=[f]:l==="category"?d.categories=[f]:l==="difficulty"?d.difficulty=[f]:l==="year"?d.years=[f]:l==="quarter"&&(d.quarters=[f]))}});let n=t.querySelector('[data-filter="date-from"]')?.value,c=t.querySelector('[data-filter="date-to"]')?.value;(n||c)&&(d.dateRange={from:n||"1900-01-01",to:c||"2099-12-31"});try{let p=await this.search(e,d);this.displaySearchResults(p,t)}catch(p){s.innerHTML=`<div class="search-error">Search failed: ${p.message}</div>`}}displaySearchResults(e,t){let a=t.querySelector(".search-results-list"),s=t.querySelector(".search-status");e.hasResults?s.innerHTML=`
                <div class="search-info">
                    Found ${e.total} result${e.total===1?"":"s"} for "${e.query}"
                </div>
            `:s.innerHTML=`
                <div class="search-no-results">
                    No results found for "${e.query}"
                </div>
            `,e.hasResults?a.innerHTML=e.results.map(i=>this.renderSearchResult(i)).join(""):a.innerHTML=""}renderSearchResult(e){let t=e.document,a=this.getTypeIcon(t.type),s=t.date?new Date(t.date).toLocaleDateString():"";return`
            <div class="search-result-item" data-type="${t.type}">
                <div class="search-result-header">
                    <h3 class="search-result-title">
                        <i class="${a}"></i>
                        <a href="${t.url}">${t.title}</a>
                    </h3>
                    <div class="search-result-meta">
                        <span class="search-result-type">${this.formatLabel(t.type)}</span>
                        ${t.category?`<span class="search-result-category">${this.formatLabel(t.category)}</span>`:""}
                        ${t.difficulty?`<span class="search-result-difficulty difficulty-${t.difficulty}">${t.difficulty}</span>`:""}
                        ${s?`<span class="search-result-date">${s}</span>`:""}
                    </div>
                </div>
                <p class="search-result-summary">${t.summary}</p>
                ${t.tags&&t.tags.length>0?`
                    <div class="search-result-tags">
                        ${t.tags.map(i=>`<span class="tag">${i}</span>`).join("")}
                    </div>
                `:""}
                <div class="search-result-score">Relevance: ${(e.score*100).toFixed(1)}%</div>
            </div>
        `}getTypeIcon(e){return{newsletter:"fas fa-newspaper",meeting:"fas fa-calendar",resource:"fas fa-book",glossary:"fas fa-book-open"}[e]||"fas fa-file"}async showSuggestions(e,t,a){try{let s=await this.getSuggestions(e);s.length>0?(t.innerHTML=s.map(i=>`
                    <div class="search-suggestion" data-url="${i.url}">
                        <i class="${this.getTypeIcon(i.type)}"></i>
                        <span>${i.text}</span>
                    </div>
                `).join(""),t.querySelectorAll(".search-suggestion").forEach(i=>{i.addEventListener("click",o=>{o.preventDefault(),a.value=i.querySelector("span").textContent,t.style.display="none",this.performUISearch(a.value,a.closest(".search-container"))})}),t.style.display="block"):t.style.display="none"}catch(s){console.error("Suggestions error:",s),t.style.display="none"}}clearResults(e){let t=e.querySelector(".search-results-list"),a=e.querySelector(".search-status"),s=e.querySelector(".search-suggestions");t&&(t.innerHTML=""),a&&(a.innerHTML=""),s&&(s.style.display="none")}static addStyles(){if(document.getElementById("search-engine-styles"))return;let e=`
            .search-container {
                margin: 2rem 0;
                font-family: var(--font-body, Arial, sans-serif);
            }

            .search-input-wrapper {
                position: relative;
                margin-bottom: 1rem;
            }

            .search-input {
                width: 100%;
                padding: 1rem 3rem 1rem 1rem;
                border: 2px solid var(--light, #ecf0f1);
                border-radius: var(--radius-md, 5px);
                font-size: 1rem;
                transition: border-color var(--transition-fast, 0.15s ease);
                box-sizing: border-box;
            }

            .search-input:focus {
                outline: none;
                border-color: var(--primary, #1a5276);
            }

            .search-button {
                position: absolute;
                right: 0.5rem;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                color: var(--medium, #7f8c8d);
                font-size: 1.2rem;
                cursor: pointer;
                padding: 0.5rem;
                border-radius: var(--radius-sm, 3px);
                transition: color var(--transition-fast, 0.15s ease);
            }

            .search-button:hover {
                color: var(--primary, #1a5276);
            }

            .search-suggestions {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--white, #fff);
                border: 1px solid var(--light, #ecf0f1);
                border-top: none;
                border-radius: 0 0 var(--radius-md, 5px) var(--radius-md, 5px);
                box-shadow: var(--shadow-lg, 0 10px 15px -3px rgba(0,0,0,0.1));
                z-index: 1000;
                max-height: 300px;
                overflow-y: auto;
            }

            .search-suggestion {
                padding: 0.75rem 1rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                transition: background-color var(--transition-fast, 0.15s ease);
            }

            .search-suggestion:hover {
                background-color: var(--light, #ecf0f1);
            }

            .search-suggestion i {
                color: var(--primary, #1a5276);
                width: 1rem;
            }

            .search-filters {
                margin-bottom: 1rem;
                background-color: var(--light, #ecf0f1);
                border-radius: var(--radius-md, 5px);
                border: 1px solid #ddd;
                transition: all var(--transition-normal, 0.25s ease);
            }

            .search-filters.collapsed .filter-row {
                display: none;
            }

            .filter-row {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                padding: 1rem;
                align-items: center;
            }

            .filter-actions {
                padding: 0.5rem 1rem;
                border-top: 1px solid #ddd;
                background-color: #f8f9fa;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .filter-group {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .filter-group label {
                font-weight: 600;
                color: var(--dark, #2c3e50);
                white-space: nowrap;
            }

            .filter-select,
            .filter-input {
                padding: 0.5rem;
                border: 1px solid var(--medium, #7f8c8d);
                border-radius: var(--radius-sm, 3px);
                background-color: var(--white, #fff);
                font-size: 0.9rem;
                min-width: 120px;
            }

            .filter-select[multiple] {
                min-height: 100px;
                min-width: 160px;
            }

            .filter-input[type="date"] {
                min-width: 140px;
            }

            .clear-filters-button,
            .toggle-filters-button {
                padding: 0.5rem 1rem;
                border: none;
                border-radius: var(--radius-sm, 3px);
                cursor: pointer;
                font-size: 0.9rem;
                transition: all var(--transition-fast, 0.15s ease);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .clear-filters-button {
                background-color: var(--warning, #f39c12);
                color: var(--white, #fff);
            }

            .clear-filters-button:hover {
                background-color: #e67e22;
            }

            .toggle-filters-button {
                background-color: var(--primary, #1a5276);
                color: var(--white, #fff);
            }

            .toggle-filters-button:hover {
                background-color: var(--primary-light, #2980b9);
            }

            .search-results {
                margin-top: 1rem;
            }

            .search-info,
            .search-no-results,
            .search-error,
            .search-loading {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: var(--radius-md, 5px);
                font-weight: 600;
            }

            .search-info {
                background-color: #e8f4f8;
                color: var(--primary, #1a5276);
                border-left: 4px solid var(--primary, #1a5276);
            }

            .search-no-results {
                background-color: #fff3cd;
                color: #856404;
                border-left: 4px solid #ffc107;
            }

            .search-error {
                background-color: #f8d7da;
                color: #721c24;
                border-left: 4px solid #dc3545;
            }

            .search-loading {
                background-color: var(--light, #ecf0f1);
                color: var(--medium, #7f8c8d);
                text-align: center;
            }

            .search-result-item {
                background-color: var(--white, #fff);
                border: 1px solid var(--light, #ecf0f1);
                border-radius: var(--radius-md, 5px);
                padding: 1.5rem;
                margin-bottom: 1rem;
                transition: box-shadow var(--transition-fast, 0.15s ease);
            }

            .search-result-item:hover {
                box-shadow: var(--shadow-md, 0 4px 6px rgba(0,0,0,0.1));
            }

            .search-result-header {
                margin-bottom: 1rem;
            }

            .search-result-title {
                margin: 0 0 0.5rem 0;
                font-size: 1.25rem;
            }

            .search-result-title a {
                color: var(--primary, #1a5276);
                text-decoration: none;
                margin-left: 0.5rem;
            }

            .search-result-title a:hover {
                text-decoration: underline;
            }

            .search-result-title i {
                color: var(--secondary, #d35400);
            }

            .search-result-meta {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                font-size: 0.9rem;
            }

            .search-result-type,
            .search-result-category,
            .search-result-difficulty,
            .search-result-date {
                padding: 0.25rem 0.5rem;
                border-radius: var(--radius-sm, 3px);
                background-color: var(--light, #ecf0f1);
                color: var(--dark, #2c3e50);
            }

            .search-result-difficulty.difficulty-beginner {
                background-color: #27ae60;
                color: var(--white, #fff);
            }

            .search-result-difficulty.difficulty-intermediate {
                background-color: #f39c12;
                color: var(--white, #fff);
            }

            .search-result-difficulty.difficulty-advanced {
                background-color: #c0392b;
                color: var(--white, #fff);
            }

            .search-result-summary {
                margin: 1rem 0;
                color: var(--medium, #7f8c8d);
                line-height: 1.6;
            }

            .search-result-tags {
                margin: 1rem 0;
            }

            .search-result-tags .tag {
                display: inline-block;
                padding: 0.25rem 0.5rem;
                margin: 0.125rem;
                background-color: var(--accent, #f1c40f);
                color: var(--dark, #2c3e50);
                border-radius: var(--radius-sm, 3px);
                font-size: 0.8rem;
            }

            .search-result-score {
                font-size: 0.8rem;
                color: var(--medium, #7f8c8d);
                text-align: right;
                margin-top: 0.5rem;
            }

            /* Mobile responsive */
            @media (max-width: 768px) {
                .filter-row {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 0.75rem;
                }

                .filter-group {
                    justify-content: space-between;
                }

                .filter-actions {
                    flex-direction: column;
                    gap: 0.5rem;
                }

                .filter-select,
                .filter-input {
                    min-width: auto;
                    width: 100%;
                }

                .search-result-meta {
                    flex-direction: column;
                    gap: 0.25rem;
                }
            }

            @media (max-width: 576px) {
                .filter-row {
                    padding: 0.75rem;
                }
                
                .filter-actions {
                    padding: 0.75rem;
                }
                
                .clear-filters-button,
                .toggle-filters-button {
                    width: 100%;
                    justify-content: center;
                }
            }
        `,t=document.createElement("style");t.id="search-engine-styles",t.textContent=e,document.head.appendChild(t)}};typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>w.addStyles()):w.addStyles());R=w;typeof window<"u"&&(window.SearchEngine=w)});function L(r,e){let t;return function(...s){let i=()=>{clearTimeout(t),r(...s)};clearTimeout(t),t=setTimeout(i,e)}}function h(r,e=document){try{return e.querySelector(r)}catch(t){return console.warn(`Failed to query selector "${r}":`,t),null}}var b=new Map;function y(r,e,t,a){if(!r||typeof r.addEventListener!="function"){console.warn("Invalid element provided to addEventListenerWithCleanup");return}r.addEventListener(e,t,a),b.has(r)||b.set(r,[]),b.get(r).push({event:e,handler:t,options:a})}function I(r=null){if(r){let e=b.get(r);e&&(e.forEach(({event:t,handler:a,options:s})=>{r.removeEventListener(t,a,s)}),b.delete(r))}else b.forEach((e,t)=>{e.forEach(({event:a,handler:s,options:i})=>{try{t.removeEventListener(a,s,i)}catch(o){console.warn("Failed to remove event listener:",o)}})}),b.clear()}typeof window<"u"&&window.addEventListener("beforeunload",()=>{I()});async function M(){let r=h("#search-interface");r&&await U(r);let e=h("#search-filters");e&&z(e);let t=h("#search-results");t&&j(t),B()}async function U(r){r.innerHTML=`
        <div class="search-main">
            <div class="search-input-container">
                <input type="search" 
                       id="main-search-input" 
                       placeholder="Search meetings, newsletters, and more..." 
                       aria-label="Search site content"
                       autocomplete="off">
                <button id="search-button" class="btn-primary" aria-label="Search">
                    \u{1F50D} Search
                </button>
            </div>
            <div class="search-suggestions" id="search-suggestions" aria-live="polite"></div>
        </div>
        
        <div class="search-stats" id="search-stats" aria-live="polite"></div>
    `;let e=r.querySelector("#main-search-input"),t=r.querySelector("#search-button"),a=r.querySelector("#search-suggestions"),s=r.querySelector("#search-stats"),i=null;try{let{SearchEngine:n}=await Promise.resolve().then(()=>(q(),F));i=new n,await i.initialize(),console.log("Search engine initialized successfully")}catch(n){console.error("Failed to initialize search engine:",n),x("Search functionality is temporarily unavailable.");return}let o=L(async n=>{if(!n.trim()){P(),a.innerHTML="";return}try{let c=await i.search(n);$(c,n),E(c.length,n),a.innerHTML=""}catch(c){console.error("Search failed:",c),x("Search failed. Please try again.")}},300),d=L(async n=>{if(!n.trim()||n.length<2){a.innerHTML="";return}try{let c=await i.getSuggestions(n,5);if(c.length>0){let p=c.map(l=>`
                    <button class="search-suggestion" data-query="${l}">
                        ${T(l,n)}
                    </button>
                `).join("");a.innerHTML=`
                    <div class="suggestions-list">
                        ${p}
                    </div>
                `,a.querySelectorAll(".search-suggestion").forEach(l=>{y(l,"click",f=>{let g=f.target.dataset.query;e.value=g,o(g),a.innerHTML=""})})}else a.innerHTML=""}catch(c){console.error("Suggestions failed:",c),a.innerHTML=""}},500);y(e,"input",n=>{let c=n.target.value;d(c),W(c,!1)}),y(e,"keypress",n=>{n.key==="Enter"&&(n.preventDefault(),o(e.value))}),y(t,"click",()=>{o(e.value)}),y(document,"click",n=>{r.contains(n.target)||(a.innerHTML="")}),window.siteSearchEngine=i}function z(r){r.innerHTML=`
        <details class="search-filters-details">
            <summary>Advanced Search Options</summary>
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="content-type-filter">Content Type:</label>
                    <select id="content-type-filter">
                        <option value="">All Content</option>
                        <option value="meetings">Meetings</option>
                        <option value="newsletters">Newsletters</option>
                        <option value="pages">Pages</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="date-range-filter">Date Range:</label>
                    <select id="date-range-filter">
                        <option value="">Any Time</option>
                        <option value="last-month">Last Month</option>
                        <option value="last-3-months">Last 3 Months</option>
                        <option value="last-year">Last Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                
                <div class="filter-group date-range-custom" style="display: none;">
                    <label for="date-from">From:</label>
                    <input type="date" id="date-from">
                    <label for="date-to">To:</label>
                    <input type="date" id="date-to">
                </div>
                
                <div class="filter-group">
                    <label for="sort-filter">Sort By:</label>
                    <select id="sort-filter">
                        <option value="relevance">Relevance</option>
                        <option value="date-desc">Newest First</option>
                        <option value="date-asc">Oldest First</option>
                        <option value="title">Title A-Z</option>
                    </select>
                </div>
                
                <div class="filter-actions">
                    <button id="apply-filters" class="btn-secondary">Apply Filters</button>
                    <button id="clear-filters" class="btn-outline">Clear</button>
                </div>
            </div>
        </details>
    `;let e=r.querySelector("#date-range-filter"),t=r.querySelector(".date-range-custom");y(e,"change",i=>{t.style.display=i.target.value==="custom"?"block":"none"});let a=r.querySelector("#apply-filters");y(a,"click",C);let s=r.querySelector("#clear-filters");y(s,"click",O)}function j(r){r.innerHTML=`
        <div id="results-container" class="results-container">
            <!-- Search results will be displayed here -->
        </div>
        <div id="results-pagination" class="results-pagination">
            <!-- Pagination will be displayed here -->
        </div>
    `}function $(r,e){let t=h("#results-container");if(!t)return;if(r.length===0){t.innerHTML=`
            <div class="no-results">
                <h3>No results found for "${e}"</h3>
                <p>Try adjusting your search terms or using different keywords.</p>
                <div class="search-tips">
                    <h4>Search Tips:</h4>
                    <ul>
                        <li>Use different keywords or synonyms</li>
                        <li>Check your spelling</li>
                        <li>Try broader search terms</li>
                        <li>Use fewer words</li>
                    </ul>
                </div>
            </div>
        `;return}let a=r.map((s,i)=>`
        <article class="search-result" data-index="${i}">
            <header class="result-header">
                <h3 class="result-title">
                    <a href="${s.url}" target="_blank">
                        ${T(s.title,e)}
                    </a>
                </h3>
                <div class="result-meta">
                    <span class="result-type">${N(s.type)}</span>
                    ${s.date?`<time datetime="${s.date}">${Y(s.date)}</time>`:""}
                    ${s.score?`<span class="result-score">Relevance: ${Math.round(s.score*100)}%</span>`:""}
                </div>
            </header>
            
            <div class="result-content">
                ${s.excerpt?`<p class="result-excerpt">${T(s.excerpt,e)}</p>`:""}
                ${s.tags&&s.tags.length>0?`
                    <div class="result-tags">
                        ${s.tags.map(o=>`<span class="tag">${o}</span>`).join("")}
                    </div>
                `:""}
            </div>
            
            <footer class="result-actions">
                <a href="${s.url}" class="btn-outline btn-small">View Full Content</a>
                ${s.downloadUrl?`<a href="${s.downloadUrl}" class="btn-outline btn-small">Download</a>`:""}
            </footer>
        </article>
    `).join("");t.innerHTML=a,typeof gtag=="function"&&gtag("event","search",{search_term:e,results_count:r.length})}function E(r,e){let t=h("#search-stats");t&&(t.innerHTML=`
        <p class="search-stats-text">
            Found <strong>${r}</strong> result${r!==1?"s":""} for "<em>${e}</em>"
        </p>
    `)}function P(){let r=h("#results-container");r&&(r.innerHTML="");let e=h("#search-stats");e&&(e.innerHTML="")}function x(r){let e=h("#results-container");e&&(e.innerHTML=`
            <div class="search-error">
                <h3>Search Error</h3>
                <p>${r}</p>
                <button onclick="location.reload()" class="btn-secondary">Refresh Page</button>
            </div>
        `)}function C(){let r=h("#main-search-input")?.value;if(!r||!window.siteSearchEngine)return;let e={contentType:h("#content-type-filter")?.value,dateRange:h("#date-range-filter")?.value,dateFrom:h("#date-from")?.value,dateTo:h("#date-to")?.value,sortBy:h("#sort-filter")?.value||"relevance"};window.siteSearchEngine.search(r,e).then(t=>{$(t,r),E(t.length,r)}).catch(t=>{console.error("Filtered search failed:",t),x("Search with filters failed. Please try again.")})}function O(){h("#content-type-filter").value="",h("#date-range-filter").value="",h("#date-from").value="",h("#date-to").value="",h("#sort-filter").value="relevance";let r=h(".date-range-custom");r&&(r.style.display="none"),C()}function B(){let e=new URLSearchParams(window.location.search).get("q");if(e){let t=h("#main-search-input");t&&window.siteSearchEngine&&(t.value=e,window.siteSearchEngine.search(e).then(a=>{$(a,e),E(a.length,e)}).catch(a=>{console.error("URL parameter search failed:",a)}))}}function W(r,e=!0){let t=new URL(window.location);r.trim()?t.searchParams.set("q",r):t.searchParams.delete("q"),e?window.history.pushState({},"",t.toString()):window.history.replaceState({},"",t.toString())}function T(r,e){if(!e.trim())return r;let t=new RegExp(`(${e.split(" ").join("|")})`,"gi");return r.replace(t,"<mark>$1</mark>")}function N(r){return{meetings:"Meeting",newsletters:"Newsletter",pages:"Page",events:"Event"}[r]||"Content"}function Y(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M();})();
