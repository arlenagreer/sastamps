var SAPA_GLOSSARY=(()=>{function p(e,t=document){try{return t.querySelector(e)}catch(o){return console.warn(`Failed to query selector "${e}":`,o),null}}async function m(){let e=p("#glossary-search-container");e&&await x(e);let t=p("#glossary-filters-container");t&&await q(t);let o=p("#glossary-content-container");o&&await F(o),await k()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m();window.initializeGlossary=m;async function x(e){try{e.innerHTML=`
            <div class="glossary-search">
                <div class="search-header">
                    <h3><i class="fas fa-search"></i> Search Glossary</h3>
                    <p>Find philatelic terms and definitions</p>
                </div>
                <div class="search-form">
                    <div class="search-input-group">
                        <input 
                            type="search" 
                            id="glossary-search-input" 
                            placeholder="Search terms, definitions, or categories..." 
                            aria-label="Search glossary terms"
                            autocomplete="off"
                        >
                        <button id="glossary-search-button" aria-label="Search" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                        <button id="glossary-clear-button" aria-label="Clear search" type="button" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-suggestions" id="search-suggestions" style="display: none;"></div>
                </div>
                <div id="search-results" style="display: none;"></div>
            </div>
        `;let t=e.querySelector("#glossary-search-input"),o=e.querySelector("#glossary-search-button"),s=e.querySelector("#glossary-clear-button"),d=e.querySelector("#search-results"),l;t.addEventListener("input",a=>{clearTimeout(l);let r=a.target.value.trim();r.length>0?(s.style.display="block",l=setTimeout(()=>g(r,d),300)):(s.style.display="none",d.style.display="none",w())}),o.addEventListener("click",()=>{let a=t.value.trim();a&&g(a,d)}),s.addEventListener("click",()=>{t.value="",s.style.display="none",d.style.display="none",w(),t.focus()}),t.addEventListener("keypress",a=>{if(a.key==="Enter"){a.preventDefault();let r=t.value.trim();r&&g(r,d)}})}catch(t){console.error("Failed to load glossary search:",t),e.innerHTML='<p class="error-message">Unable to load search functionality.</p>'}}async function q(e){try{let s=(await(await fetch("data/glossary/glossary.json")).json()).terms||[],d=[...new Set(s.map(n=>n.category))].sort(),l=[...new Set(s.map(n=>n.difficulty))].sort(),a=[...new Set(s.map(n=>n.subcategory).filter(Boolean))].sort();e.innerHTML=`
            <div class="glossary-filters">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="category-filter">
                            <i class="fas fa-layer-group"></i> Category
                        </label>
                        <select id="category-filter" aria-label="Filter by category">
                            <option value="">All Categories</option>
                            ${d.map(n=>`<option value="${n}">${v(n)}</option>`).join("")}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="difficulty-filter">
                            <i class="fas fa-signal"></i> Difficulty
                        </label>
                        <select id="difficulty-filter" aria-label="Filter by difficulty">
                            <option value="">All Levels</option>
                            ${l.map(n=>`<option value="${n}">${b(n)}</option>`).join("")}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="sort-filter">
                            <i class="fas fa-sort"></i> Sort By
                        </label>
                        <select id="sort-filter" aria-label="Sort terms">
                            <option value="alphabetical">Alphabetical</option>
                            <option value="category">Category</option>
                            <option value="difficulty">Difficulty</option>
                            <option value="recent">Recently Added</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <button id="filter-reset" type="button" class="btn btn-secondary">
                            <i class="fas fa-undo"></i> Reset Filters
                        </button>
                    </div>
                </div>
                
                <div class="alphabet-nav" id="alphabet-nav">
                    <span class="alphabet-label">Jump to letter:</span>
                    ${Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZ").map(n=>`<button class="alphabet-btn" data-letter="${n}">${n}</button>`).join("")}
                </div>
            </div>
        `;let r=e.querySelector("#category-filter"),i=e.querySelector("#difficulty-filter"),c=e.querySelector("#sort-filter"),y=e.querySelector("#filter-reset"),f=e.querySelectorAll(".alphabet-btn");[r,i,c].forEach(n=>{n.addEventListener("change",$)}),y.addEventListener("click",()=>{r.value="",i.value="",c.value="alphabetical",$()}),f.forEach(n=>{n.addEventListener("click",S=>{let{letter:L}=S.target.dataset;j(L),f.forEach(C=>C.classList.remove("active")),S.target.classList.add("active")})})}catch(t){console.error("Failed to load glossary filters:",t),e.innerHTML='<p class="error-message">Unable to load filters.</p>'}}async function F(e){try{let s=(await(await fetch("data/glossary/glossary.json")).json()).terms||[];if(s.length===0){e.innerHTML=`
                <div class="card">
                    <div class="card-content text-center">
                        <h3>No Terms Available</h3>
                        <p>The glossary is currently being updated. Please check back soon.</p>
                    </div>
                </div>
            `;return}window.glossaryTerms=s,h(s,e)}catch(t){console.error("Failed to load glossary content:",t),e.innerHTML=`
            <div class="card">
                <div class="card-content text-center">
                    <h3>Error Loading Glossary</h3>
                    <p>Unable to load glossary terms. Please try refreshing the page.</p>
                </div>
            </div>
        `}}function h(e,t){if(e.length===0){t.innerHTML=`
            <div class="card">
                <div class="card-content text-center">
                    <h3>No Terms Found</h3>
                    <p>No terms match your current search or filter criteria.</p>
                </div>
            </div>
        `;return}let o={};e.forEach(l=>{let a=l.term.charAt(0).toUpperCase();o[a]||(o[a]=[]),o[a].push(l)});let d=Object.keys(o).sort().map(l=>`
        <div class="glossary-section" id="section-${l}">
            <h2 class="glossary-letter-header">${l}</h2>
            <div class="glossary-terms">
                ${o[l].map(a=>E(a)).join("")}
            </div>
        </div>
    `).join("");t.innerHTML=d,t.addEventListener("click",l=>{if(l.target.closest(".term-header")){let a=l.target.closest(".glossary-term"),r=a.querySelector(".term-content"),i=a.querySelector(".expand-icon");r.style.display==="none"||!r.style.display?(r.style.display="block",i.style.transform="rotate(180deg)",a.classList.add("expanded")):(r.style.display="none",i.style.transform="rotate(0deg)",a.classList.remove("expanded"))}if(l.target.closest(".related-term")){l.preventDefault();let{termId:a}=l.target.closest(".related-term").dataset;T(a)}})}function E(e){let t=b(e.difficulty),o=v(e.category);return`
        <div class="glossary-term" id="term-${e.id}" data-term-id="${e.id}">
            <div class="term-header">
                <div class="term-title-group">
                    <h3 class="term-title">${u(e.term)}</h3>
                    ${e.alternateNames&&e.alternateNames.length>0?`<div class="alternate-names">
                            Also known as: ${e.alternateNames.map(s=>u(s)).join(", ")}
                        </div>`:""}
                </div>
                <div class="term-meta">
                    <span class="difficulty-badge difficulty-${e.difficulty}">${t}</span>
                    <span class="category-badge">${o}</span>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
            </div>
            
            <div class="term-content" style="display: none;">
                <div class="term-definition">
                    <p class="definition">${u(e.definition)}</p>
                    ${e.detailedDescription?`<div class="detailed-description">
                            <p>${u(e.detailedDescription)}</p>
                        </div>`:""}
                </div>
                
                ${e.examples&&e.examples.length>0?`
                    <div class="term-examples">
                        <h4><i class="fas fa-lightbulb"></i> Examples</h4>
                        <ul>
                            ${e.examples.map(s=>`
                                <li>
                                    ${u(s.description)}
                                    ${s.caption?`<span class="example-caption">${u(s.caption)}</span>`:""}
                                </li>
                            `).join("")}
                        </ul>
                    </div>
                `:""}
                
                ${e.etymology?`
                    <div class="term-etymology">
                        <h4><i class="fas fa-history"></i> Etymology</h4>
                        <p><strong>Origin:</strong> ${u(e.etymology.origin)}</p>
                        <p><strong>Meaning:</strong> ${u(e.etymology.meaning)}</p>
                        ${e.etymology.history?`<p><strong>History:</strong> ${u(e.etymology.history)}</p>`:""}
                    </div>
                `:""}
                
                ${e.relatedTerms&&e.relatedTerms.length>0?`
                    <div class="related-terms">
                        <h4><i class="fas fa-link"></i> Related Terms</h4>
                        <div class="related-terms-list">
                            ${e.relatedTerms.map(s=>`<a href="#term-${s}" class="related-term" data-term-id="${s}">${D(s)}</a>`).join("")}
                        </div>
                    </div>
                `:""}
                
                ${e.tags&&e.tags.length>0?`
                    <div class="term-tags">
                        ${e.tags.map(s=>`<span class="tag">${u(s)}</span>`).join("")}
                    </div>
                `:""}
            </div>
        </div>
    `}async function g(e,t){try{let d=(await(await fetch("data/glossary/glossary.json")).json()).terms||[],l=e.toLowerCase(),a=d.filter(r=>r.term.toLowerCase().includes(l)||r.definition.toLowerCase().includes(l)||r.detailedDescription&&r.detailedDescription.toLowerCase().includes(l)||r.tags&&r.tags.some(i=>i.toLowerCase().includes(l))||r.category&&r.category.toLowerCase().includes(l)||r.alternateNames&&r.alternateNames.some(i=>i.toLowerCase().includes(l)));a.length===0?t.innerHTML=`
                <div class="search-no-results">
                    <p><strong>No results found for "${u(e)}"</strong></p>
                    <p>Try searching for related terms or browse by category.</p>
                </div>
            `:t.innerHTML=`
                <div class="search-results-header">
                    <p>Found <strong>${a.length}</strong> result${a.length!==1?"s":""} for "<strong>${u(e)}</strong>"</p>
                </div>
                <div class="search-results-list">
                    ${a.map(r=>`
                        <div class="search-result-item">
                            <h4><a href="#term-${r.id}" onclick="scrollToTerm('${r.id}')">${u(r.term)}</a></h4>
                            <p class="result-definition">${u(r.definition)}</p>
                            <div class="result-meta">
                                <span class="result-category">${v(r.category)}</span>
                                <span class="result-difficulty">${b(r.difficulty)}</span>
                            </div>
                        </div>
                    `).join("")}
                </div>
            `,t.style.display="block"}catch(o){console.error("Search failed:",o),t.innerHTML='<p class="error-message">Search temporarily unavailable. Please try again.</p>',t.style.display="block"}}function $(){var l,a,r;let e=((l=document.querySelector("#category-filter"))==null?void 0:l.value)||"",t=((a=document.querySelector("#difficulty-filter"))==null?void 0:a.value)||"",o=((r=document.querySelector("#sort-filter"))==null?void 0:r.value)||"alphabetical";if(!window.glossaryTerms)return;let s=[...window.glossaryTerms];switch(e&&(s=s.filter(i=>i.category===e)),t&&(s=s.filter(i=>i.difficulty===t)),o){case"category":s.sort((c,y)=>c.category!==y.category?c.category.localeCompare(y.category):c.term.localeCompare(y.term));break;case"difficulty":let i={beginner:1,intermediate:2,advanced:3};s.sort((c,y)=>{let f=i[c.difficulty]||999,n=i[y.difficulty]||999;return f!==n?f-n:c.term.localeCompare(y.term)});break;case"recent":s.sort((c,y)=>{let f=new Date(c.dateAdded||"1970-01-01");return new Date(y.dateAdded||"1970-01-01")-f});break;case"alphabetical":default:s.sort((c,y)=>c.term.localeCompare(y.term));break}let d=document.querySelector("#glossary-content-container");d&&h(s,d)}function w(){let e=document.querySelector("#glossary-content-container");e&&window.glossaryTerms&&h(window.glossaryTerms,e)}function j(e){let t=document.querySelector(`#section-${e}`);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function T(e){let t=document.querySelector(`#term-${e}`);if(t){t.scrollIntoView({behavior:"smooth",block:"center"});let o=t.querySelector(".term-content"),s=t.querySelector(".expand-icon");o&&o.style.display!=="block"&&(o.style.display="block",s&&(s.style.transform="rotate(180deg)"),t.classList.add("expanded")),t.classList.add("highlighted"),setTimeout(()=>t.classList.remove("highlighted"),2e3)}}async function k(){try{let o=(await(await fetch("data/glossary/glossary.json")).json()).terms||[],s=o.length,d=new Set(o.map(c=>c.category)).size,l=o.reduce((c,y)=>{var f;return c+(((f=y.relatedTerms)==null?void 0:f.length)||0)},0),a=document.querySelector("#total-terms"),r=document.querySelector("#total-categories"),i=document.querySelector("#total-references");a&&(a.textContent=s),r&&(r.textContent=d),i&&(i.textContent=l)}catch(e){console.error("Failed to load glossary stats:",e)}}function v(e){return e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function b(e){return e.charAt(0).toUpperCase()+e.slice(1)}function D(e){return e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function u(e){if(!e)return"";let t=document.createElement("div");return t.textContent=e,t.innerHTML}window.scrollToTerm=T;})();
